name: Smart Study Bot

on:
  # Automatic schedule (Bangladesh Time)
  schedule:
    - cron: '0 2 * * *'  # 8:00 AM BDT
    - cron: '0 4 * * *'  # 10:00 AM BDT
    - cron: '0 6 * * *'  # 12:00 PM BDT
    - cron: '0 9 * * *'  # 3:00 PM BDT
    - cron: '0 11 * * *' # 5:00 PM BDT
    - cron: '0 13 * * *' # 7:00 PM BDT
    - cron: '0 15 * * *' # 9:00 PM BDT
  
  # Manual trigger
  workflow_dispatch:

jobs:
  send-post:
    runs-on: ubuntu-latest
    
    steps:
    # Step 1: Checkout code
    - name: Checkout repository
      uses: actions/checkout@v4
    
    # Step 2: Setup Python
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # Step 3: Install Telegram Bot library
    - name: Install dependencies
      run: pip install python-telegram-bot
    
    # Step 4: Verify BOT_TOKEN
    - name: Verify BOT_TOKEN
      run: |
        if [ -z "${{ secrets.BOT_TOKEN }}" ]; then
          echo "âŒ ERROR: BOT_TOKEN is NOT set in GitHub Secrets!"
          echo ""
          echo "To fix this:"
          echo "1. Go to: https://github.com/biswajitgii/smart-study-bot/settings/secrets/actions"
          echo "2. Click 'New repository secret'"
          echo "3. Name: BOT_TOKEN"
          echo "4. Value: Your Telegram bot token (from @BotFather)"
          echo "5. Click 'Add secret'"
          echo ""
          echo "Your bot token should look like: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
          exit 1
        else
          echo "âœ… BOT_TOKEN is set in GitHub Secrets"
          echo "Token starts with: ${{ secrets.BOT_TOKEN }}"
        fi
    
    # Step 5: Create Python script
    - name: Create Python script
      run: |
        cat > telegram_bot.py << 'EOF'
import os
import telegram
from datetime import datetime

def main():
    # Get token from environment
    BOT_TOKEN = os.getenv('BOT_TOKEN')
    CHANNEL_ID = "@smartstudynotes11"
    
    print("ðŸ¤– Starting Smart Study Bot...")
    print(f"ðŸ“± Channel: {CHANNEL_ID}")
    
    if not BOT_TOKEN:
        print("âŒ ERROR: BOT_TOKEN environment variable is not set")
        return 1
    
    print(f"âœ… Token found (length: {len(BOT_TOKEN)})")
    
    try:
        # Create bot instance
        bot = telegram.Bot(token=BOT_TOKEN)
        
        # Test connection
        me = bot.get_me()
        print(f"âœ… Bot connected: @{me.username}")
        
        # Create post content
        current_time = datetime.now().strftime("%d %B, %Y %I:%M %p")
        
        post_text = f"""ðŸ“š *Smart Study Notes* ðŸ“š
========================

ðŸŽ¯ *à¦†à¦œà¦•à§‡à¦° à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£ à¦ªà§à¦°à¦¶à§à¦¨:*
========================

ðŸ”¬ *à¦ªà¦¦à¦¾à¦°à§à¦¥à¦¬à¦¿à¦œà§à¦žà¦¾à¦¨ (Class 11):*
â€¢ à¦¨à¦¿à¦‰à¦Ÿà¦¨à§‡à¦° à¦—à¦¤à¦¿à¦° à¦¸à§‚à¦¤à§à¦°à¦—à§à¦²à§‹ à¦¬à¦°à§à¦£à¦¨à¦¾ à¦•à¦°
â€¢ à¦¬à¦² à¦“ à¦—à¦¤à¦¿à¦° à¦®à¦§à§à¦¯à§‡ à¦¸à¦®à§à¦ªà¦°à§à¦• à¦²à¦¿à¦–

ðŸ§ª *à¦°à¦¸à¦¾à¦¯à¦¼à¦¨ (Class 12):*
â€¢ à¦°à¦¾à¦¸à¦¾à¦¯à¦¼à¦¨à¦¿à¦• à¦¬à¦¨à§à¦§à¦¨ à¦•à¦¾à¦•à§‡ à¦¬à¦²à§‡?
â€¢ à¦œà§ˆà¦¬ à¦°à¦¸à¦¾à¦¯à¦¼à¦¨à§‡à¦° à¦®à§Œà¦²à¦¿à¦• à¦§à¦¾à¦°à¦£à¦¾

âž— *à¦—à¦£à¦¿à¦¤ (College Year 1):*
â€¢ à¦•à§à¦¯à¦¾à¦²à¦•à§à¦²à¦¾à¦¸à§‡à¦° à¦¸à¦‚à¦œà§à¦žà¦¾ à¦¦à¦¾à¦“
â€¢ à¦…à¦¨à§à¦¤à¦°à§€à¦•à¦°à¦£à§‡à¦° à¦¨à¦¿à¦¯à¦¼à¦®à¦¾à¦¬à¦²à§€

ðŸ’» *à¦ªà§à¦°à§‹à¦—à§à¦°à¦¾à¦®à¦¿à¦‚ (College Year 2):*
â€¢ Array à¦à¦¬à¦‚ Linked List à¦à¦° à¦ªà¦¾à¦°à§à¦¥à¦•à§à¦¯
â€¢ Data Structures à¦à¦° à¦—à§à¦°à§à¦¤à§à¦¬

ðŸ—„ï¸ *à¦¡à§‡à¦Ÿà¦¾à¦¬à§‡à¦¸ (College Year 3):*
â€¢ SQL à¦à¦¬à¦‚ NoSQL à¦¡à§‡à¦Ÿà¦¾à¦¬à§‡à¦¸
â€¢ Database Management System

â° *à¦ªà§‹à¦¸à§à¦Ÿà§‡à¦° à¦¸à¦®à¦¯à¦¼:* {current_time}

ðŸ¤– *à¦¬à¦Ÿà§‡à¦° à¦¬à¦¿à¦¶à§‡à¦·à¦¤à§à¦¬:*
â€¢ à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼ à¦ªà§à¦°à¦¶à§à¦¨ à¦ªà§‹à¦¸à§à¦Ÿà¦¿à¦‚
â€¢ à§§à§¦à§¦% à¦ªà¦°à§€à¦•à§à¦·à¦¾à¦° à¦œà¦¨à§à¦¯ à¦—à§à¦°à§à¦¤à§à¦¬à¦ªà§‚à¦°à§à¦£
â€¢ à¦¦à§ˆà¦¨à¦¿à¦• à§­ à¦¬à¦¾à¦° à¦†à¦ªà¦¡à§‡à¦Ÿ
â€¢ à¦•à§‹à¦¨à§‹ à¦ªà§à¦°à¦¶à§à¦¨ à¦ªà§à¦¨à¦°à¦¾à¦¯à¦¼ à¦ªà§‹à¦¸à§à¦Ÿ à¦¹à¦¯à¦¼ à¦¨à¦¾

ðŸ“Œ *à¦šà§à¦¯à¦¾à¦¨à§‡à¦²à§‡ à¦¯à§à¦•à§à¦¤ à¦¹à¦¨:* @smartstudynotes11
ðŸ”— *à¦¬à¦Ÿ à¦²à¦¿à¦‚à¦•:* @smartstudy11bot
ðŸ”” *à¦¨à§‹à¦Ÿà¦¿à¦«à¦¿à¦•à§‡à¦¶à¦¨ à¦šà¦¾à¦²à§ à¦°à¦¾à¦–à§à¦¨*
"""
        
        # Send message to Telegram channel
        bot.send_message(
            chat_id=CHANNEL_ID,
            text=post_text,
            parse_mode="Markdown",
            disable_web_page_preview=True
        )
        
        print("âœ… Post sent successfully to Telegram!")
        print("ðŸ“¢ Check your channel: @smartstudynotes11")
        return 0
        
    except telegram.error.Unauthorized as e:
        print(f"âŒ ERROR: Invalid BOT_TOKEN - {e}")
        print("Please check your bot token from @BotFather")
        return 1
    except telegram.error.BadRequest as e:
        print(f"âŒ ERROR: Channel issue - {e}")
        print("Make sure:")
        print("1. Bot is admin in @smartstudynotes11")
        print("2. Channel username is correct")
        return 1
    except Exception as e:
        print(f"âŒ ERROR: {type(e).__name__} - {e}")
        return 1

if __name__ == "__main__":
    exit(main())
EOF
    
    # Step 6: Run the bot
    - name: Run Telegram Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      run: python telegram_bot.py
    
    # Step 7: Success message
    - name: Success Message
      if: success()
      run: |
        echo ""
        echo "ðŸŽ‰ ðŸŽ‰ ðŸŽ‰ SUCCESS! ðŸŽ‰ ðŸŽ‰ ðŸŽ‰"
        echo "âœ… Smart Study Bot is working perfectly!"
        echo "ðŸ“¢ Check your Telegram channel: @smartstudynotes11"
        echo ""
        echo "â° Next automatic posts at:"
        echo "   8:00 AM BDT"
        echo "   10:00 AM BDT"
        echo "   12:00 PM BDT"
        echo "   3:00 PM BDT"
        echo "   5:00 PM BDT"
        echo "   7:00 PM BDT"
        echo "   9:00 PM BDT"
        echo ""
        echo "ðŸ¤– Bot will automatically post 7 times daily!"
