name: Smart Study Bot

on:
  schedule:
    # Bangladesh Time (UTC+6) converted to UTC
    # 8:00 AM BDT = 2:00 AM UTC
    # 10:00 AM BDT = 4:00 AM UTC
    # 12:00 PM BDT = 6:00 AM UTC
    # 3:00 PM BDT = 9:00 AM UTC
    # 5:00 PM BDT = 11:00 AM UTC
    # 7:00 PM BDT = 1:00 PM UTC
    # 9:00 PM BDT = 3:00 PM UTC
    
    - cron: '0 2 * * *'  # 8:00 AM BDT
    - cron: '0 4 * * *'  # 10:00 AM BDT
    - cron: '0 6 * * *'  # 12:00 PM BDT
    - cron: '0 9 * * *'  # 3:00 PM BDT
    - cron: '0 11 * * *' # 5:00 PM BDT
    - cron: '0 13 * * *' # 7:00 PM BDT
    - cron: '0 15 * * *' # 9:00 PM BDT
  
  # Manual trigger
  workflow_dispatch:
    inputs:
      note:
        description: 'Manual run'
        required: false
        default: 'Test run'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4
      
      # Step 2: Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      # Step 3: Install dependencies
      - name: Install dependencies
        run: |
          pip install python-telegram-bot==20.3
          pip install requests==2.31.0
          pip install schedule==1.2.0
          pip install python-dotenv==1.0.0
      
      # Step 4: Setup environment
      - name: Setup environment
        run: |
          echo "BOT_TOKEN=${{ secrets.BOT_TOKEN }}" > .env
          echo "CHANNEL_ID=@smartstudynotes11" >> .env
          echo "DEBUG=True" >> .env
          echo "âœ… Environment file created"
      
      # Step 5: Create data directory
      - name: Create directories
        run: |
          mkdir -p data
          echo "âœ… Directories created"
      
      # Step 6: Run the bot
      - name: Run Smart Study Bot
        run: |
          echo "ğŸš€ Starting Smart Study Bot..."
          python main.py
          echo "âœ… Bot execution completed"
      
      # Step 7: Success message
      - name: Success notification
        if: success()
        run: |
          echo "ğŸ‰ Smart Study Bot ran successfully!"
          echo "ğŸ“… Next run times (BDT):"
          echo "   - 8:00 AM"
          echo "   - 10:00 AM"
          echo "   - 12:00 PM"
          echo "   - 3:00 PM"
          echo "   - 5:00 PM"
          echo "   - 7:00 PM"
          echo "   - 9:00 PM"
      
      # Step 8: Failure message
      - name: Failure notification
        if: failure()
        run: |
          echo "âŒ Smart Study Bot failed!"
          echo "Please check the logs above for errors."
