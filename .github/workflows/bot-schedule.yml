name: Smart Study Bot

on:
  schedule:
    # Bangladesh Time (UTC+6) to UTC:
    # 8:00 AM BD = 2:00 AM UTC
    # 10:00 AM BD = 4:00 AM UTC
    # 12:00 PM BD = 6:00 AM UTC
    # 3:00 PM BD = 9:00 AM UTC
    # 5:00 PM BD = 11:00 AM UTC
    # 7:00 PM BD = 1:00 PM UTC
    # 9:00 PM BD = 3:00 PM UTC
    
    - cron: '0 2 * * *'
    - cron: '0 4 * * *'
    - cron: '0 6 * * *'
    - cron: '0 9 * * *'
    - cron: '0 11 * * *'
    - cron: '0 13 * * *'
    - cron: '0 15 * * *'
  
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install Python packages
      run: |
        pip install python-telegram-bot requests
        
    - name: Debug - Check if BOT_TOKEN exists
      run: |
        if [ -z "${{ secrets.BOT_TOKEN }}" ]; then
          echo "âŒ ERROR: BOT_TOKEN is empty or not set!"
          echo "Please go to: Settings â†’ Secrets â†’ Actions"
          echo "Add BOT_TOKEN with your Telegram bot token"
          exit 1
        else
          echo "âœ… BOT_TOKEN is set (first 10 chars): ${BOT_TOKEN:0:10}..."
        fi
        
    - name: Create and run simple bot script
      run: |
        cat > simple_bot.py << 'EOF'
import os
import asyncio
import telegram
import logging

# Setup logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def main():
    # Get token from environment
    BOT_TOKEN = os.environ.get('BOT_TOKEN')
    CHANNEL_ID = "@smartstudynotes11"
    
    if not BOT_TOKEN:
        logger.error("âŒ BOT_TOKEN not found in environment")
        print("ERROR: BOT_TOKEN is missing!")
        return False
    
    print(f"âœ… BOT_TOKEN found (starts with): {BOT_TOKEN[:10]}...")
    print(f"âœ… CHANNEL_ID: {CHANNEL_ID}")
    
    try:
        # Initialize bot
        bot = telegram.Bot(token=BOT_TOKEN)
        
        # Test connection
        me = await bot.get_me()
        print(f"âœ… Bot connected: @{me.username}")
        
        # Create simple post
        post = """ðŸ“š *Smart Study Notes* ðŸ“š

ðŸŽ“ *Today's Important Questions*

ðŸ”¬ *Physics:*
â€¢ Newton's Laws of Motion

ðŸ§ª *Chemistry:*
â€¢ Chemical Bonding

âž— *Mathematics:*
â€¢ Calculus Basics

ðŸ¤– Bot is working perfectly!
ðŸ“¢ Channel: @smartstudynotes11
ðŸ•’ Time: Now"""
        
        # Send to Telegram
        await bot.send_message(
            chat_id=CHANNEL_ID,
            text=post,
            parse_mode="Markdown"
        )
        
        print("âœ… Post sent successfully to Telegram!")
        return True
        
    except Exception as e:
        print(f"âŒ Error: {str(e)}")
        return False

if __name__ == "__main__":
    result = asyncio.run(main())
    if not result:
        exit(1)
EOF
        
        # Run the bot
        BOT_TOKEN="${{ secrets.BOT_TOKEN }}" python simple_bot.py
        
    - name: Check if successful
      if: success()
      run: |
        echo "ðŸŽ‰ SUCCESS! Bot ran without errors."
        echo "ðŸ“¢ Check your Telegram channel: @smartstudynotes11"
        
    - name: Show error if failed
      if: failure()
      run: |
        echo "âŒ FAILED! Check the logs above for details."
        echo "Common issues:"
        echo "1. BOT_TOKEN not set in GitHub Secrets"
        echo "2. Bot is not admin in the channel"
        echo "3. Channel username is wrong"
