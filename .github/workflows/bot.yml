name: Smart Study Bot

on:
  schedule:
    # Bangladesh Time (UTC+6) to UTC:
    # 8:00 AM BDT = 2:00 AM UTC
    # 10:00 AM BDT = 4:00 AM UTC
    # 12:00 PM BDT = 6:00 AM UTC
    # 3:00 PM BDT = 9:00 AM UTC
    # 5:00 PM BDT = 11:00 AM UTC
    # 7:00 PM BDT = 1:00 PM UTC
    # 9:00 PM BDT = 3:00 PM UTC
    
    - cron: '0 2 * * *'
    - cron: '0 4 * * *'
    - cron: '0 6 * * *'
    - cron: '0 9 * * *'
    - cron: '0 11 * * *'
    - cron: '0 13 * * *'
    - cron: '0 15 * * *'
  
  workflow_dispatch:

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check for BOT_TOKEN
      run: |
        echo "Checking BOT_TOKEN..."
        if [ -n "${{ secrets.BOT_TOKEN }}" ]; then
          echo "âœ… BOT_TOKEN is set"
          echo "Token starts with: ${BOT_TOKEN:0:10}..."
        else
          echo "âŒ ERROR: BOT_TOKEN is NOT set!"
          echo "Please go to: Settings â†’ Secrets â†’ Actions"
          echo "Add a secret named 'BOT_TOKEN' with your Telegram bot token"
          exit 1
        fi
    
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install Python Telegram Bot
      run: pip install python-telegram-bot==20.3
    
    - name: Create and run bot script
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      run: |
        cat > bot.py << 'EOF'
import os
import asyncio
import telegram
import logging

# Setup logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def main():
    # Get token from environment
    BOT_TOKEN = os.getenv('BOT_TOKEN')
    CHANNEL_ID = "@smartstudynotes11"
    
    print("ðŸ” Debug Information:")
    print(f"BOT_TOKEN present: {'Yes' if BOT_TOKEN else 'No'}")
    if BOT_TOKEN:
        print(f"Token length: {len(BOT_TOKEN)}")
        print(f"Token starts with: {BOT_TOKEN[:10]}...")
    
    if not BOT_TOKEN:
        print("âŒ ERROR: BOT_TOKEN not found in environment")
        print("Please set BOT_TOKEN in GitHub Secrets")
        return False
    
    try:
        # Create bot instance
        bot = telegram.Bot(token=BOT_TOKEN)
        
        # Test connection
        me = await bot.get_me()
        print(f"âœ… Bot connected successfully!")
        print(f"ðŸ¤– Bot username: @{me.username}")
        print(f"ðŸ†” Bot ID: {me.id}")
        
        # Create educational post
        post_text = """ðŸ“š *Smart Study Notes* ðŸ“š

ðŸŽ¯ *Today's Important Questions:*

ðŸ”¬ *Physics (Class 11):*
â€¢ à¦¨à¦¿à¦‰à¦Ÿà¦¨à§‡à¦° à¦—à¦¤à¦¿à¦° à¦¸à§‚à¦¤à§à¦°
â€¢ à¦•à¦¾à¦œ, à¦¶à¦•à§à¦¤à¦¿ à¦“ à¦•à§à¦·à¦®à¦¤à¦¾
â€¢ à¦¤à¦¾à¦ªà¦—à¦¤à¦¿à¦¬à¦¿à¦¦à§à¦¯à¦¾

ðŸ§ª *Chemistry (Class 12):*
â€¢ à¦°à¦¾à¦¸à¦¾à¦¯à¦¼à¦¨à¦¿à¦• à¦¬à¦¨à§à¦§à¦¨
â€¢ à¦œà§ˆà¦¬ à¦°à¦¸à¦¾à¦¯à¦¼à¦¨
â€¢ à¦ªà¦°à¦¿à¦¬à§‡à¦¶ à¦°à¦¸à¦¾à¦¯à¦¼à¦¨

âž— *Mathematics (College):*
â€¢ à¦•à§à¦¯à¦¾à¦²à¦•à§à¦²à¦¾à¦¸
â€¢ à¦²à¦¿à¦¨à¦¿à¦¯à¦¼à¦¾à¦° à¦…à§à¦¯à¦¾à¦²à¦œà§‡à¦¬à§à¦°à¦¾
â€¢ à¦ªà¦°à¦¿à¦¸à¦‚à¦–à§à¦¯à¦¾à¦¨

ðŸ¤– *Smart Study Bot Features:*
â€¢ Automatic posting
â€¢ 100% exam important
â€¢ Daily 7 updates
â€¢ No duplicate posts

ðŸ“¢ *Channel:* @smartstudynotes11
ðŸ”— *Bot:* @smartstudy11bot
â° *Time:* Now"""
        
        # Send to Telegram channel
        await bot.send_message(
            chat_id=CHANNEL_ID,
            text=post_text,
            parse_mode="Markdown",
            disable_web_page_preview=True
        )
        
        print("âœ… Message sent successfully to Telegram channel!")
        print(f"ðŸ“¢ Channel: {CHANNEL_ID}")
        return True
        
    except telegram.error.Unauthorized:
        print("âŒ ERROR: Invalid BOT_TOKEN!")
        print("Please check your bot token from @BotFather")
        return False
    except telegram.error.BadRequest as e:
        print(f"âŒ ERROR: Channel issue: {e}")
        print("Make sure bot is admin in @smartstudynotes11")
        return False
    except Exception as e:
        print(f"âŒ ERROR: {type(e).__name__}: {e}")
        return False

if __name__ == "__main__":
    success = asyncio.run(main())
    exit(0 if success else 1)
EOF
        
        # Run the bot
        python bot.py
    
    - name: Success Message
      if: success()
      run: |
        echo "ðŸŽ‰ ðŸŽ‰ ðŸŽ‰ CONGRATULATIONS! ðŸŽ‰ ðŸŽ‰ ðŸŽ‰"
        echo "âœ… Smart Study Bot is working perfectly!"
        echo "ðŸ“¢ Check your Telegram channel: @smartstudynotes11"
        echo "â° Next automatic runs at:"
        echo "   8:00 AM BDT"
        echo "   10:00 AM BDT"
        echo "   12:00 PM BDT"
        echo "   3:00 PM BDT"
        echo "   5:00 PM BDT"
        echo "   7:00 PM BDT"
        echo "   9:00 PM BDT"
